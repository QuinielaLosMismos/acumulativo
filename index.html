<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Quiniela Los Mismos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root{
      --blue:#0b1bb8;      /* azul fuerte (franja) */
      --blue-2:#0a138a;    /* azul profundo (sombras) */
      --card:#0b1120;      /* cupón */
      --text:#f9fafb;
      --muted:#cbd5e1;
      --line:rgba(255,255,255,.14);
      --accent:#22c55e;
      --danger:#ef4444;
    }

    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,sans-serif}

    /* Fondo con tonos como tu imagen */
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:14px;
      color:var(--text);

      background:
        linear-gradient(to bottom,
          #f6f7fb 0%,
          #eef0f7 38%,
          var(--blue) 38%,
          var(--blue) 48%,
          #eef0f7 48%,
          #f6f7fb 100%);
    }

    .wrapper{width:100%;max-width:430px}

    .card{
      position:relative;
      border-radius:18px;
      overflow:hidden;
      box-shadow:0 16px 40px rgba(2,6,23,.35);
      border:1px solid rgba(2,6,23,.10);
      background: var(--card);
    }

    /* Silueta suave de porra detrás del cupón (SVG embebido) */
    .card::before{
      content:"";
      position:absolute;
      inset:0;
      background-image:
        url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 900 500'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' y1='0' x2='0' y2='1'%3E%3Cstop offset='0' stop-color='%23ffffff' stop-opacity='0.10'/%3E%3Cstop offset='1' stop-color='%23000000' stop-opacity='0.18'/%3E%3C/linearGradient%3E%3C/defs%3E%3Cpath fill='url(%23g)' d='M0,340 C80,310 140,340 220,310 C280,290 320,330 380,310 C430,296 480,322 540,305 C610,285 650,330 720,310 C790,290 840,320 900,300 L900,500 L0,500 Z'/%3E%3Cpath fill='%23000000' fill-opacity='0.18' d='M55,360 c10,-30 40,-40 60,-10 c8,12 6,30 0,40 c-10,18 -50,15 -60,-30 Z'/%3E%3Cpath fill='%23000000' fill-opacity='0.18' d='M140,360 c10,-30 40,-40 60,-10 c8,12 6,30 0,40 c-10,18 -50,15 -60,-30 Z'/%3E%3Cpath fill='%23000000' fill-opacity='0.18' d='M230,360 c10,-30 40,-40 60,-10 c8,12 6,30 0,40 c-10,18 -50,15 -60,-30 Z'/%3E%3Cpath fill='%23000000' fill-opacity='0.18' d='M320,360 c10,-30 40,-40 60,-10 c8,12 6,30 0,40 c-10,18 -50,15 -60,-30 Z'/%3E%3Cpath fill='%23000000' fill-opacity='0.18' d='M410,360 c10,-30 40,-40 60,-10 c8,12 6,30 0,40 c-10,18 -50,15 -60,-30 Z'/%3E%3Cpath fill='%23000000' fill-opacity='0.18' d='M500,360 c10,-30 40,-40 60,-10 c8,12 6,30 0,40 c-10,18 -50,15 -60,-30 Z'/%3E%3Cpath fill='%23000000' fill-opacity='0.18' d='M590,360 c10,-30 40,-40 60,-10 c8,12 6,30 0,40 c-10,18 -50,15 -60,-30 Z'/%3E%3Cpath fill='%23000000' fill-opacity='0.18' d='M680,360 c10,-30 40,-40 60,-10 c8,12 6,30 0,40 c-10,18 -50,15 -60,-30 Z'/%3E%3Cpath fill='%23000000' fill-opacity='0.18' d='M770,360 c10,-30 40,-40 60,-10 c8,12 6,30 0,40 c-10,18 -50,15 -60,-30 Z'/%3E%3C/svg%3E");
      background-size: cover;
      background-position: center bottom;
      opacity: .45;            /* “suave” */
      pointer-events:none;
    }

    .inner{
      position:relative;
      z-index:1;
      padding:0;
    }

    /* Banner / logo */
    .banner{
      padding:14px 14px 12px;
      background:
        radial-gradient(circle at 20% 0%, rgba(255,255,255,.20) 0, transparent 55%),
        radial-gradient(circle at 80% 0%, rgba(255,255,255,.14) 0, transparent 55%),
        linear-gradient(180deg, rgba(2,6,23,.35), rgba(2,6,23,.05));
      border-bottom:1px solid var(--line);
      text-align:center;
    }

    .banner-title{
      font-weight:900;
      letter-spacing:.18em;
      text-transform:uppercase;
      font-size:1.08rem;
      line-height:1.1;
    }

    .banner-title span{
      color: var(--accent);
    }

    .banner-sub{
      margin-top:4px;
      font-size:.82rem;
      font-weight:700;
      color: var(--text);
      opacity:.95;
    }

    .banner-info{
      margin-top:2px;
      font-size:.72rem;
      color: var(--muted);
    }

    /* Inputs */
    .content{ padding:12px 14px 12px; }

    .inputs{display:flex;flex-direction:column;gap:8px;margin-bottom:10px}

    .input-box{
      border-radius:12px;
      border:1px solid var(--line);
      background: rgba(2,6,23,.35);
      padding:8px 10px 6px;
    }
    .input-label{
      font-size:.68rem;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:.10em;
    }
    input{
      border:none;background:transparent;width:100%;
      outline:none;color:var(--text);
      font-size:.86rem;font-weight:650;
      padding-top:3px;
    }

    /* Tabla / cupón */
    .table-wrap{
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(2,6,23,.45);
      overflow:hidden;
    }

    table{width:100%;border-collapse:collapse;font-size:.80rem}
    td{padding:8px 6px}

    tbody tr{border-top:1px solid rgba(255,255,255,.07)}
    tbody tr:hover{background: rgba(11,27,184,.18)}

    .num{width:22px;text-align:center;font-weight:800;color:#e5e7eb}

    .team{
      display:flex;
      align-items:center;
      gap:6px;
      text-transform:uppercase;
      font-weight:800;
      letter-spacing:.02em;
      font-size:.72rem;
      color:#f1f5f9;
    }

    /* Escudos SIN círculo */
    .team img{
      width:22px;height:22px;
      object-fit:contain;
      border-radius:0;
      border:none;
      background:transparent;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,.35));
    }

    .pick{text-align:center;width:36px}
    .pick label{position:relative;display:inline-block}
    .pick input{position:absolute;opacity:0}

    .pick span{
      display:inline-flex;
      width:32px;height:28px;
      align-items:center;justify-content:center;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.22);
      background: rgba(2,6,23,.55);
      font-weight:900;
      cursor:pointer;
      transition: transform .10s ease, box-shadow .10s ease, border-color .10s ease;
    }

    .pick input:checked + span{
      border-color: rgba(34,197,94,.9);
      box-shadow: 0 0 0 2px rgba(34,197,94,.25);
      transform: translateY(-1px);
    }

    /* Footer */
    .footer{
      margin-top:10px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      flex-wrap:wrap;
    }

    .status{font-size:.72rem;color:var(--muted)}
    .status.error{color:var(--danger)}
    .status.success{color:var(--accent)}

    button{
      border:none;border-radius:999px;
      padding:8px 15px;
      font-size:.80rem;
      font-weight:800;
      cursor:pointer;
    }

    .btn-clear{
      background: rgba(2,6,23,.45);
      color: var(--muted);
      border:1px solid var(--line);
    }

    .btn-send{
      background: linear-gradient(135deg, #22c55e, #4ade80);
      color: #022c22;
      box-shadow:0 10px 22px rgba(34,197,94,.45);
    }

    @media (max-width: 430px){
      .wrapper{max-width:390px}
      .team{font-size:.70rem}
      .pick span{width:30px;height:26px}
    }
  </style>
</head>

<body>
  <div class="wrapper">
    <div class="card">
      <div class="inner">

        <div class="banner">
          <div class="banner-title">QUINIELA <span>LOS MISMOS</span></div>
          <div id="subtitulo" class="banner-sub"></div>
          <div id="cierre" class="banner-info"></div>
        </div>

        <div class="content">
          <div class="inputs">
            <div class="input-box">
              <div class="input-label">Teléfono *</div>
              <input id="telefono" type="tel" placeholder="10 dígitos o con lada">
            </div>
            <div class="input-box">
              <div class="input-label">Nombre</div>
              <input id="nombre" type="text" placeholder="Nombre">
            </div>
          </div>

          <div class="table-wrap">
            <table>
              <tbody id="tbody"></tbody>
            </table>
          </div>

          <div class="footer">
            <div id="status" class="status">Cargando quiniela…</div>
            <div>
              <button class="btn-clear" onclick="limpiar()">Limpiar</button>
              <button class="btn-send" onclick="enviar()">Enviar</button>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

<script>
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwpMZP9pseM_0A3ENqb9JHnuK0NEw5Qzt8HD1msfHtMvuGxIDUshuJR_Olro4a3fEM9FQ/exec";

  const tbody = document.getElementById("tbody");
  const statusEl = document.getElementById("status");

  function logo(team){
    let s = team.normalize("NFD").replace(/[\u0300-\u036f]/g,"")
      .toLowerCase().replace(/[^a-z0-9]/g,"");
    if(s==="cruzazul") return "assets/cruzazul.png";
    if(s==="sanluis") return "assets/sanluis.png";
    return "assets/"+s+".png";
  }

  async function cargar(){
    try{
      const r = await fetch(SCRIPT_URL+"?action=getConfig");
      const d = await r.json();
      if(!d.ok) throw new Error(d.message || "No se pudo obtener la quiniela");

      document.getElementById("subtitulo").textContent = d.subtitulo || "";
      document.getElementById("cierre").textContent   = d.cierre ? ("Cierre: " + d.cierre) : "";

      tbody.innerHTML = "";
      d.partidos.forEach(p=>{
        tbody.innerHTML += `
          <tr data-local="${p.local}" data-visita="${p.visita}">
            <td class="num">${p.numero}</td>

            <td class="pick">
              <label>
                <input type="radio" name="p${p.numero}" value="L">
                <span>L</span>
              </label>
            </td>

            <td>
              <div class="team">
                <img src="${logo(p.local)}" onerror="this.style.display='none'">
                ${p.local}
              </div>
            </td>

            <td class="pick">
              <label>
                <input type="radio" name="p${p.numero}" value="E">
                <span>E</span>
              </label>
            </td>

            <td>
              <div class="team">
                <img src="${logo(p.visita)}" onerror="this.style.display='none'">
                ${p.visita}
              </div>
            </td>

            <td class="pick">
              <label>
                <input type="radio" name="p${p.numero}" value="V">
                <span>V</span>
              </label>
            </td>
          </tr>
        `;
      });

      statusEl.textContent = "Selecciona tus pronósticos";
      statusEl.className = "status";
    }catch(e){
      statusEl.textContent = e.message || "Error al cargar la quiniela";
      statusEl.className = "status error";
    }
  }

  function limpiar(){
    document.querySelectorAll("input[type=radio]").forEach(r=>r.checked=false);
    statusEl.textContent = "Limpio";
    statusEl.className = "status";
  }

  async function enviar(){
    try{
      const telefono = document.getElementById("telefono").value.trim();
      const nombre   = document.getElementById("nombre").value.trim();

      if(!telefono) throw new Error("Ingresa teléfono");

      const filas = [...tbody.querySelectorAll("tr")];
      const partidos = [];
      filas.forEach(f=>{
        const sel = f.querySelector("input:checked");
        if(!sel) throw new Error("Faltan selecciones");
        partidos.push({
          local: f.dataset.local,
          visita: f.dataset.visita,
          pronostico: sel.value
        });
      });

      const r = await fetch(SCRIPT_URL,{
        method:"POST",
        headers:{ "Content-Type":"text/plain;charset=utf-8" },
        body: JSON.stringify({ telefono, nombre, partidos })
      });

      const d = JSON.parse(await r.text());
      if(!d.ok) throw new Error(d.message || "Error al registrar");

      statusEl.textContent = "Enviada ✅";
      statusEl.className = "status success";
      window.open(d.whatsappUrl, "_blank");

    }catch(e){
      statusEl.textContent = e.message || "Error al enviar";
      statusEl.className = "status error";
    }
  }

  cargar();
</script>
</body>
</html>
